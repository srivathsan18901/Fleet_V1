<div class="topbar">
  <div class="Projmsg1">
    <p class="Projmsg_t">{{ getTranslation('project') }} :</p>
    <p class="Projmsg_N">{{ projectName }}</p>
  </div>
  <div class="TopbarContents">
    <app-loader></app-loader>
    <!-- <div class="timer">
      <app-timer></app-timer>
    </div> -->

    <!-- Fleet Status Indicator -->
    <div
      class="fleet-status"
      [ngClass]="{ 'fleet-up': isFleetUp, 'fleet-down': !isFleetUp }"
    >
      <img
        [src]="
          isFleetUp ? '../../assets/Liveoff.svg' : '../../assets/Liveon.svg'
        "
      />
      {{ isFleetUp ? getTranslation('liveStatus') : getTranslation('liveStatus') }}

    </div>

    <button class="indication-button" [ngClass]="buttonClass">
      <!-- <img [src]="iconUrl" class="icon" alt="Icon" /> -->
      <span>{{ getTranslation(isFleet ? 'fleetMode' : 'simulation') }}</span>
    </button>

    <app-fullscreen-button></app-fullscreen-button>

    <div class="notification" style=" margin: 8px 5px 0px; " (click)="toggleNotificationPopup($event)">
      <!-- <img alt="" src="../../assets/icons/Notification_icon.svg" (click)="toggleNotificationPopup()" class="Nlogo" /> -->
      <i class="pi pi-bell p-mr-4 p-text-secondary" pBadge style="font-size: 1.4rem; color: #ff7373;" [value]="notifications.length" ></i>
    </div>

     <div class="language-selector">
      <div class="language-toggle" (click)="languageChange()">
        <span class="language-info">
           <div [(innerHTML)]="flagSvg" class="flag-icon"></div>
          <p class="flag-name">{{flagName}}</p> 
     </span>
        <!-- <svg [ngClass]="{'rotate': languageArrowState}" class="arrow-icon" width="12" height="9" viewBox="0 0 12 9" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5.75505 8.33739L0 2.58245L1.91834 0.664062L5.75505 4.50076L9.59169 0.664062L11.51 2.58245L5.75505 8.33739Z" fill="black"/>
        </svg> -->
      </div> 
    <!-- language dropdown -->

     <div *ngIf="languageArrowState" class="language-dropdown">
        <div *ngFor="let flag of flags; trackBy: trackFlag" class="language-option" (click)="changeFlag(flag.order)">
          <span class="option-info">
            <div [(innerHTML)]="flag.flagComp" class="flag-icon"></div>
            <p class="flag-name">{{flag.nameTag}}</p>
          </span>
        </div>
      </div> 
     </div>  

    <div class="Profile" (click)="toggleProfilePopup()">
      <img
        src="../../assets/icons/profile.png"
        alt="profile pic"
        routerLink="/profile"
        class="PPicon"
      />
      <div class="profile-info">
        <p class="username">{{ username }}</p>
        <p class="userrole">{{ getTranslation(userrole) }}</p>
      </div>
    </div>
  </div>
</div>
<div class="Profile-popup" *ngIf="showProfilePopup">
  <div style=" text-align: center; margin-bottom: 5px; border-radius: 4px; border-bottom: 1px solid #ff3333; " >
    <p class="msg">{{ getTranslation('profileHello') }}, {{ username }}</p>
    <!-- <p class="Projmsg">Project: {{ projectName }}</p> -->
  </div>
  <div class="Option_set">
    <div class="logoutIcon" (click)="exportProject()">
      <img src="../../assets/Export.svg" alt="" class="Outlogo" />
      <span class="logoutlabel">{{ getTranslation('exportProject') }}</span>
    </div>
    <!-- <div class="logoutIcon" (click)="showLogoutConfirmation = true">
    <img src="../../assets/icons/Logout.svg " alt="" class="Outlogo" />
    <span class="logoutlabel">Logout</span>
  </div> -->
  </div>
  <div class="timer">
    <app-timer></app-timer>
  </div>
</div>
<!-- side bar -->
<div class="Sidenav">
  <div class="sidebar">
    <div class="logo-container">
      <img src="../../assets/Motherson_full_logo.jpeg" alt="" class="Logo" />
      <img src="../../assets/shared image.jpeg" alt="" class="logo2" />
    </div>

    <div class="icons">
      <div
        *ngIf="userManagementData.generalPermissions.dashboard"
        class="icon1"
        routerLink="/dashboard"
        routerLinkActive="active"
      >
        <img
          src="../../assets/icons/dashboard_icon copy.svg"
          alt=""
          class="Dlogo"
        />
        <span class="label">{{ getTranslation('dashboard') }}</span>
      </div>

      <div
        *ngIf="userManagementData.generalPermissions.statistics"
        class="icon2"
        routerLink="/statistics"
        routerLinkActive="active"
      >
        <img src="../../assets/icons/Statistics.svg" alt="" class="Slogo" />
        <span class="label">{{ getTranslation('statistics') }}</span>
      </div>

      <div
        *ngIf="userManagementData.generalPermissions.robots"
        class="icon3"
        routerLink="/robots"
        routerLinkActive="active"
      >
        <img
          src="../../assets/icons/Statistics_icon.svg"
          alt=""
          class="Slogo"
        />
        <span class="label">{{ getTranslation('robots') }}</span>
      </div>

      <!-- cookieValue.role !== "User" -->
      @if (cookieValue?.role) {
      <div class="icon4" routerLink="/configuration" routerLinkActive="active">
        <img
          src="../../assets/icons/Configuration_icons.svg"
          alt=""
          class="Clogo"
        />
        <span class="label">{{ getTranslation('configuration') }}</span>
      </div>
      }

      <div
        *ngIf="userManagementData.generalPermissions.errors"
        class="icon5"
        routerLink="/Reports"
        routerLinkActive="active"
      >
        <img src="../../assets/icons/Logs_icons.svg" alt="" class="Llogo" />
        <span class="label">{{ getTranslation('errorLogs') }}</span>
      </div>
      <div
        *ngIf="userManagementData.generalPermissions.tasks"
        class="icon6"
        routerLink="/tasks"
        routerLinkActive="active"
      >
        <img src="../../assets/icons/Tasks_icons.svg" alt="" class="Llogo" />
        <span class="label">{{ getTranslation('tasks') }}</span>
      </div>

      <!-- (cookieValue.role === "Administrator") -->
      @if (cookieValue?.role) {
      <div
        *ngIf="userManagementData.generalPermissions.userManagement"
        class="icon7"
        routerLink="/usermanagement"
        routerLinkActive="active"
      >
        <img
          src="../../assets/icons/Usermanagement_icons.svg"
          alt=""
          class="Llogo"
        />
        <span class="label">{{ getTranslation('userManagement') }}</span>
      </div>
      }

      <!-- <div class="icon8" routerLink="/support" routerLinkActive="active">
        <img src="../../assets/icons/support.svg" alt=""  class="Llogo" />
        <span class="label">Support</span>
      </div> -->
    </div>

    <div class="icons logout-icon" (click)="showLogoutConfirmation = true">
      <img src="../../assets/icons/Logout_icon.svg " alt="" class="Outlogo" />
      <span class="label">{{ getTranslation('logout') }}</span>
    </div>
  </div>
</div>

<!-- notification popup -->

<div class="notification-popup" [ngClass]="{ show: showNotificationPopup }">
  <!-- Clear All Button -->
  <div class="notification-header">
    <h3>{{ getTranslation('notifications') }}</h3>
    <div class="button-container">
      <button class="close-button" (click)="closeNotification()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          width="24"
          height="24"
        >
          <path fill="none" d="M0 0h24v24H0z" />
          <path
            d="M12 10.586l4.95-4.95 1.414 1.414L13.414 12l4.95 4.95-1.414 1.414L12 13.414l-4.95 4.95-1.414-1.414L10.586 12 5.636 7.05l1.414-1.414L12 10.586z"
          />
        </svg>
      </button>
    </div>
  </div>

  <!-- Scrollable notification container -->
  <div class="scrollable-container">
    <ng-container
      *ngIf="notifications && notifications.length > 0; else noNotifications"
    >
      <ul>
        <li
          *ngFor="let notification of notifications"
          [ngClass]="getNotificationClass(notification.type)"
        >
          <span class="notification-label">{{ notification.label }}</span>
          <span class="notification-message">{{ notification.message }}</span>
        </li>
      </ul>
    </ng-container>
  </div>

  <ng-template #noNotifications>
    <div class="no-notifications">
      <img src="../../assets/icons/NoNoti.svg" />
      <h2>{{ getTranslation('noNotifications') }}</h2>
    </div>
  </ng-template>
  <div class="Clr-BTN" *ngIf="notifications && notifications.length > 0">
    <button class="clear-all-btn" (click)="clearAllNotifications()">
      {{ getTranslation('clearAll') }}
    </button>
  </div>
</div>

<div *ngIf="showLogoutConfirmation" class="confirmation-popup-overlay">
  <div class="confirmation-popup">
    <div class="Img">
      <img class="WarningImg" src="../../assets/Warning.svg" />
      <!-- <img class="SWImg" src="../../assets/shared image.jpeg"> -->
    </div>
    <p class="P1">{{ getTranslation('confirmLogout') }}</p>
    <p class="P2">{{ getTranslation('logoutMessage') }}</p>
    <div class="button-container">
      <button class="confirm-btn" (click)="logout()">{{ getTranslation('confirm') }}</button>
      <button class="cancel-btn" (click)="showLogoutConfirmation = false">
        {{ getTranslation('cancel') }}
      </button>
    </div>
  </div>
</div>
